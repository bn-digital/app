---
name: Integration
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'
  pull_request:
    branches:
      - latest
    paths:
      - '.github/workflows/integration.yml'
      - 'helmfile.*'
      - '**/*/.env.*'
      - 'Dockerfile'
      - '.dockerignore'
      - 'yarn.lock'
      - 'packages/website/public/**/*'
      - 'packages/website/src/**/*'
      - 'packages/cms/config/**/*'
      - 'packages/cms/src/**/*'
      - 'packages/cms/public/**/*'
      - 'packages/cms/database/**/*'

jobs:
  setup:
    if: ${{ github.actor != 'dependabot[bot]' }}
    uses: bn-digital/vault/.github/workflows/import-secrets.yml@latest
    secrets: inherit
  build:
    if: ${{ github.actor != 'dependabot[bot]' }}
    needs: [setup]
    uses: bn-digital/docker/.github/workflows/build-images.yml@latest
    secrets: inherit
